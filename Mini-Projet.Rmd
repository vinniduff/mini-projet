---
title: "Mini-Projet"
author: "Vincent Dufresne, Benjamin Gosselin"
output: 
  html_notebook: 
    toc: yes
    toc_float: yes
    collapsed: false
    smooth_scroll: false
    toc_depth: 4
---


# Installing dependencies
```{r}
#install.packages("tseries")
#install.packages("tsbox")
#install.packages("psych")
library(tseries)
library(tsbox)
library(psych)
library(copula)
```


# Data Extraction
```{r}
xic <- get.hist.quote(instrument = "XIC.TO", start = "2013-04-15", end = "2022-03-11", quote = "AdjClose")
xus <- get.hist.quote(instrument = "XUS.TO", start = "2013-04-15", end = "2022-03-11", quote = "AdjClose")
```
# Manipulating Data Frames

We will first need to generate log returns and we also need to split data between estimation set and "out-of-sample"
set which we will later use to analyze the performance the model.

## Generating Log Returns
```{r}
#We generate log returns for all observations of XIC and XUS
xic$logreturn <- log(xic$Adjusted)

xus$logreturn <- log(xus$Adjusted)
```

## Creating data frames

### XIC
```{r}
xic_df <- ts_df(xic[,1])
colnames(xic_df) <- c("Date", "Adjusted")
xic_df$logreturn <- log(xic_df$Adjusted)
colnames(xic_df) <- c("Date", "Adjusted", "logreturn")
head(xic_df)
```


### XUS
```{r}
xus_df <- ts_df(xus[,1])
colnames(xus_df) <- c("Date", "Adjusted")
xus_df$logreturn <- log(xus_df$Adjusted)
colnames(xus_df) <- c("Date", "Adjusted", "logreturn")
head(xus_df)
```



## Splitting data

```{r}
#Estimation set size
est_size = 2000

#Test set size
test_size <- length(xic[,1]) - est_size
```


### XIC
```{r}
#Estimation set
xic_est <- xic[1:est_size,]
xic_est_df <- xic_df[1:est_size,]

#Test set
xic_test <- xic[-(1:est_size),]
xic_test_df <- xic_df[-(1:est_size),]

#Checking lengths are ok
length(xic_est[,1]) + length(xic_test[,1]) == length(xic[,1])

```



### XUS
```{r}
#Estimation set
xus_est <- xus[1:est_size,]
xus_est_df <- xus_df[1:est_size,]

#Test set
xus_test <- xus[-(1:est_size),]
xus_test_df <- xus_df[-(1:est_size),]

#Checking lengths are ok
length(xus_est[,1]) + length(xus_test[,1]) == length(xus[,1])

```

# Analyzing Data

## Summary of series

### XIC

#### Full set
```{r}
desc <- describe(xic[, 1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xic)
par(mfrow=c(1,2))
plot(x=xic_df$Date, y=xic_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xic_df$Date, y=xic_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")

```

#### Estimation set
```{r}
desc <- describe(xic_est[, 1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xic_est)
par(mfrow=c(1,2))
plot(x=xic_est_df$Date, y=xic_est_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xic_est_df$Date, y=xic_est_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")
```



#### Test set
```{r}
desc <- describe(xic_test[, 1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xic_test)
par(mfrow=c(1,2))
plot(x=xic_test_df$Date, y=xic_test_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xic_test_df$Date, y=xic_test_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")

```



### XUS

#### Full set
```{r}
desc <- describe(xus[,1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xus)
par(mfrow=c(1,2))
plot(x=xus_df$Date, y=xus_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xus_df$Date, y=xus_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")
```


#### Estimation set
```{r}
desc <- describe(xus_est[, 1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xus_est)
par(mfrow=c(1,2))
plot(x=xus_est_df$Date, y=xus_est_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xus_est_df$Date, y=xus_est_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")
```

#### Test set
```{r}
desc <- describe(xus_test[, 1:2])
desc$excess_kur <- desc$kurtosis - 3
desc
plot(xus_test)
par(mfrow=c(1,2))
plot(x=xus_test_df$Date, y=xus_test_df$Adjusted, type='l', xlab="Date", ylab="Adjusted", main="Ajdusted as a function of Date")
plot(x=xus_test_df$Date, y=xus_test_df$logreturn, type='l', xlab="Date", ylab="logreturn", main="logreturn as a function of Date")
```

# Models

## Gaussian

$$r_{i,t} = \mu_i + \sigma_{i,t}\epsilon_{i,t},\space where \space \epsilon_{i,t} \sim N(0,1)$$

### Model Estimation

We know R has a function to model garch models for data of ts type (time series) so we will use it. To get more info on how to use the function one can run the next chunk of code
```{r}
#install.packages("rugarch")
library(rugarch)
library(xts)
?rugarch
```

#### Model Specifications
```{r}
ug_gauss <- ugarchspec()
```



Once we are familiarized, we can fit our model

#### XIC

```{r}
lr_xic <- as.xts(xic_est$logreturn)
ugfit_xic <- ugarchfit(spec = ug_gauss, data = lr_xic)

ugfit_xic@fit$coef
ug_xic_var <- ugfit_xic@fit$var
ug_xic_res2 <- (ugfit_xic@fit$residuals)^2

plot(ug_xic_res2)
lines(ug_xic_var, col='green')
```




#### XUS

```{r}
lr_xus <- as.xts(xus_est$logreturn)
ugfit_xus <- ugarchfit(spec = ug_gauss, data = lr_xus)

ugfit_xus@fit$coef
ug_xus_var <- ugfit_xus@fit$var
ug_xus_res2 <- (ugfit_xus@fit$residuals)^2

plot(ug_xus_res2, ylim=c(0,0.04))
lines(ug_xus_var, col='green')
```



### Copulas

```{r}
lr <- xic_est
lr$Adjusted <- xus_est$logreturn
colnames(lr) <- c("xus", "xic")
lr <- as.xts(lr)
df <- data.frame(lr)
#plot(x=df$xus, y=df$xic, xlab="XUS", ylab="XIC", main="XIC as a function of XUS")
plot(df)

cor(lr)
```




#### Gaussian

```{r}
gauss_cop <- 
```


#### Student-t

```{r}

```


#### Frank

```{r}

```


#### Clayton

```{r}

```


## Student-t

$$r_{i,t} = \mu_i + \sigma_{i,t}\epsilon_{i,t},\space where \space \epsilon_{i,t} \sim t_{\nu i}$$

### Copulas


#### Gaussian

```{r}

```

#### Student-t

```{r}

```


#### Frank

```{r}

```


#### Clayton

```{r}

```


